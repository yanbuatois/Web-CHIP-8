!function(e){var t={};function s(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,s),i.l=!0,i.exports}s.m=e,s.c=t,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)s.d(r,i,function(t){return e[t]}.bind(null,i));return r},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/dist/",s(s.s=0)}([function(e,t,s){"use strict";s.r(t);var r={height:32,width:64,factor:8};class i{constructor(e){this.file=e,this.canvas=document.getElementById("chip8-canvas"),this.beeper=document.getElementById("beep-audio"),this.canvas.height=r.height*r.factor,this.canvas.width=r.width*r.factor,this.lock=!1,this.context=this.canvas.getContext("2d"),this.context?new Response(e).arrayBuffer().then(e=>this.startEmulation(e),e=>this.handleError(e)):this.handleError(new Error("Your navigator must support 2D canvas to use this emulator."))}startEmulation(e){this.buffer=e,this.delayTimer=0,this.soundTimer=0,this.opcode=0,this.pc=512,this.I=0,this.wasBlocked=!1,this.blocked=!1,this.unblockKey=0,this.superRoutines=[],this.shouldDraw=!1,this.keys=new Array(16).fill(!1),this.ram=new Uint8Array(4096).fill(0),this.registers=new Uint8Array(16).fill(0),this.matrix=[];for(let e=0;e<r.width;++e)this.matrix.push(new Uint8Array(r.height).fill(0));new Uint8Array(this.buffer).forEach((e,t)=>{this.ram[512+t]=e});for(let e=80;e<=160;++e){const t=[240,144,144,144,240,32,96,32,32,112,240,16,240,128,240,240,16,240,16,240,144,144,240,16,16,240,128,240,16,240,240,128,240,144,240,240,16,32,64,64,240,144,240,144,240,240,144,240,16,240,240,144,240,144,144,224,144,224,144,224,240,128,128,128,240,224,144,144,144,224,240,128,240,128,240,240,128,240,128,128];this.ram[e]=t[e-80]}this.clear(),this.registerKeyboardEvents(),setInterval(()=>this.gameLoop(),1/60*1e3)}keyToKeyboard(e){switch(e){case 49:return 1;case 50:return 2;case 51:return 3;case 52:return 12;case 81:return 4;case 87:return 5;case 69:return 6;case 82:return 13;case 65:return 7;case 83:return 8;case 68:return 9;case 70:return 14;case 90:return 10;case 88:return 0;case 67:return 11;case 66:return 15;default:return!1}}registerKeyboardEvents(){this.canvas.addEventListener("keydown",e=>{e.preventDefault(),this.blocked=!1;const t=this.keyToKeyboard(e.keyCode);this.unblockKey=t,!1!==t&&(this.keys[t]=!0)}),this.canvas.addEventListener("keyup",e=>{e.preventDefault();const t=this.keyToKeyboard(e.keyCode);!1!==t&&(this.keys[t]=!1)})}clear(){this.matrix=[];for(let e=0;e<r.width;++e)this.matrix.push(new Uint8Array(r.height).fill(0));this.shouldDraw=!0}beep(){this.beeper.currentTime=0,this.beeper.play()}gameLoop(){this.tickLogic(),this.tickDraw()}tickDraw(){if(!this.shouldDraw)return;const e=this.matrix.length;for(let t=0;t<e;++t){const e=this.matrix[t],s=e.length;for(let i=0;i<s;++i){const s=e[i],h=t*r.factor,o=i*r.factor;this.context.fillStyle=s?"#FFFFFF":"#000000",this.context.fillRect(h,o,r.factor,r.factor)}}this.shouldDraw=!1}delayTimerEnded(){}soundTimerEnded(){this.beep()}tickLogic(){this.beeper.pause(),this.delayTimer&&(--this.delayTimer,this.delayTimer&&this.delayTimerEnded()),this.soundTimer&&(--this.soundTimer,this.soundTimer&&this.soundTimerEnded()),this.opcode=this.ram[this.pc]<<8|this.ram[this.pc+1],this.interpretOpcode()&&(this.pc+=2)}interpretOpcode(){let e,t,s,r,i,h,o=!1;switch((61440&this.opcode)>>12){case 1:this.pc=4095&this.opcode,o=!0;break;case 2:this.superRoutines.push(this.pc),this.pc=4095&this.opcode,o=!0;break;case 3:e=(3840&this.opcode)>>8,s=this.registers[e],r=255&this.opcode,this.pc+=s===r?2:0;break;case 4:e=(3840&this.opcode)>>8,s=this.registers[e],r=255&this.opcode,this.pc+=s!==r?2:0;break;case 5:e=(3840&this.opcode)>>8,s=this.registers[e],t=(240&this.opcode)>>4,r=this.registers[t],this.pc+=s===r?2:0;break;case 6:e=(3840&this.opcode)>>8,this.registers[e]=255&this.opcode;break;case 7:e=(3840&this.opcode)>>8,i=255&this.opcode,this.registers[e]+=i,this.registers[e]&=255;break;case 8:switch(e=(3840&this.opcode)>>8,t=(240&this.opcode)>>4,61455&this.opcode){case 32768:this.registers[e]=this.registers[t];break;case 32769:this.registers[e]=this.registers[e]|this.registers[t];break;case 32770:this.registers[e]=this.registers[e]&this.registers[t];break;case 32771:this.registers[e]=this.registers[e]^this.registers[t];break;case 32772:this.registers[e]+=this.registers[t],this.registers[e]>255?(this.registers[e]=255&this.registers[e],this.registers[15]=1):this.registers[15]=0;break;case 32773:this.registers[e]-=this.registers[t],this.registers[e]<0?(this.registers[e]=255&this.registers[e],this.registers[15]=1):this.registers[15]=0;break;case 32774:this.registers[15]=1&this.registers[e],this.registers[e]>>=1;break;case 32775:this.registers[e]=this.registers[t]-this.registers[e],this.registers[e]<0?(this.registers[e]=255&this.registers[e],this.registers[15]=1):this.registers[15]=0;break;case 32782:this.registers[15]=128&this.registers[e],this.registers[e]<<=1;break;default:this.handleError(new Error(`Unknown opcode (0x${this.opcode.toString(16)})`))}break;case 9:e=(3840&this.opcode)>>8,s=this.registers[e],t=(240&this.opcode)>>4,r=this.registers[t],this.pc+=s!==r?2:0;break;case 10:this.I=4095&this.opcode;break;case 11:this.pc=this.registers[0]+(4095&this.opcode),o=!0;break;case 12:e=(3840&this.opcode)>>8,i=255&this.opcode,h=Math.floor(255*Math.random()),this.registers[e]=h&i;break;case 13:(()=>{const e=(3840&this.opcode)>>8,t=(240&this.opcode)>>4,s=15&this.opcode,r=this.registers[e],i=this.registers[t],h=r+8,o=i+s;this.registers[15]=0;for(let e=r;e<h&&e<this.matrix.length;++e){const t=this.matrix[e];for(let s=i;s<o&&s<t.length;++s){const h=this.ram[this.I+(s-i)]&128>>e-r,o=t[s];h&&o&&(this.registers[15]=1),this.matrix[e][s]^=h?1:0}}this.shouldDraw=!0})();break;default:switch(61695&this.opcode){case 224:this.clear();break;case 238:this.pc=this.superRoutines.pop();break;case 57502:e=(3840&this.opcode)>>8,s=this.registers[e],this.pc+=this.keys[s]?2:0;break;case 57505:e=(3840&this.opcode)>>8,s=this.registers[e],this.pc+=this.keys[s]?0:2;break;case 61447:e=(3840&this.opcode)>>8,this.registers[e]=this.delayTimer;break;case 61450:this.blocked||!this.wasBlocked?(this.wasBlocked=!0,this.blocked=!0,o=!0):(e=(3840&this.opcode)>>8,this.registers[e]=this.unblockKey,this.wasBlocked=!1);break;case 61461:e=(3840&this.opcode)>>8,i=this.registers[e],this.delayTimer=i;break;case 61464:e=(3840&this.opcode)>>8,i=this.registers[e],this.soundTimer=i;break;case 61470:e=(3840&this.opcode)>>8,this.I+=this.registers[e],this.I>4095?(this.I&=4095,this.registers[15]=1):this.registers[15]=0;break;case 61481:e=(3840&this.opcode)>>8,i=this.registers[e],this.I=80+5*i;break;case 61491:e=(3840&this.opcode)>>8,i=this.registers[e],this.ram[this.I]=Math.floor(i/100),this.ram[this.I+1]=Math.floor(i%100/10),this.ram[this.I+2]=i%10;break;case 61525:t=(3840&this.opcode)>>8;for(let e=0;e<=t;++e)this.ram[this.I+e]=this.registers[e];break;case 61541:t=(3840&this.opcode)>>8;for(let e=0;e<=t;++e)this.registers[e]=this.ram[this.I+e];break;default:this.handleError(new Error(`Unknown opcode (0x${this.opcode.toString(16)})`))}}return!o}handleError(e){const t=document.getElementById("errors");t.innerText=e.message,t.classList.remove("d-none"),console.error(e)}}let h=null;window.addEventListener("load",()=>{const e=document.getElementById("rom-file");document.getElementById("rom-loader").addEventListener("submit",t=>{t.preventDefault(),e.files.length<1||(document.getElementById("rom-loader-btn").disabled=!0,h=new i(e.files[0]))})})}]);
//# sourceMappingURL=bundle.js.map